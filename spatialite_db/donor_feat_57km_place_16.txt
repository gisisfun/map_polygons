.mode csv
.headers on
DROP TABLE IF EXISTS "feat_57km_16_place_count";

CREATE TABLE feat_57km_16_place_count AS
SELECT Feat_Aust.Poly as P,
Feat_Aust.Feat_Code as Feat_Code,
Feat_Aust.Feat_Prop as Area_Wt,
Count(*) as Places,
Total.places as Total_Places
FROM [feat_aust_57km_sa1_16] as Feat_Aust 
INNER JOIN [gis_osm_places_free_1] as Place
ON ST_Within(Place.geometry,Feat_Aust.geometry) 
INNER JOIN [shape_57km_place_count] as Total
ON Feat_Aust.Poly=Total.Poly
GROUP BY P,Feat_Code,Total_Places;

.output ../csv/donor_feat_57km_place_16.csv

select * from donor_feat_57km_place_16;

.quit
